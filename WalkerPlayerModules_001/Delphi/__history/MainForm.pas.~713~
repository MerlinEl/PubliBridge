// https://docwiki.embarcadero.com/RADStudio/Sydney/en/Default_Keyboard_Shortcuts

unit MainForm;

interface

uses
    Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
    System.Classes, Vcl.Graphics, StrUtils, Math, IOUtils,
    Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls,
    Vcl.ButtonGroup, Generics.Collections, TypInfo, WalkerPlayerCmd,
    WalkerPlayerOptions, MainFormSettings, WalkerPlayerUtils,
    Data.Bind.EngExt, Vcl.Bind.DBEngExt, Data.Bind.Components;

type
    TForm1 = class(TForm)
        GroupBox6: TGroupBox;
        TxtConsole: TMemo;
        grpOptions: TGroupBox;
        grpWalkerPlayer: TGroupBox;
        BtnPlayLesson: TButton;
        BtnPlay3D: TButton;
        BtnPlayVideo: TButton;
        BtnPlayAudio: TButton;
        BtnPlayImages: TButton;
        lbl1: TLabel;
        Cbx3DList: TComboBox;
        lbl5: TLabel;
        CbxVideoList: TComboBox;
        lbl6: TLabel;
        CbxAudioList: TComboBox;
        lbl7: TLabel;
        CbxImageList: TComboBox;
        lbl8: TLabel;
        ChkEscapeEnabled: TCheckBox;
        ChkAutoPlay: TCheckBox;
        ChkHiddenPlayer: TCheckBox;
        ChkHiddenConsole: TCheckBox;
        CbxLessonList: TComboBox;
        CbxBookDir: TComboBox;
        lbl9: TLabel;
        Button1: TButton;
        ChkResizable: TCheckBox;
    EdtUserName: TEdit;
    CbxWindowSize: TComboBox;
    Label4: TLabel;
    lbl2: TLabel;
        procedure BtnSayHelloClick(Sender: TObject);
        procedure OnFormShown(Sender: TObject);
        procedure BtnPlayLessonClick(Sender: TObject);
        procedure BtnPlayVideoClick(Sender: TObject);
        procedure BtnPlayAudioClick(Sender: TObject);
        procedure BtnPlayImagesClick(Sender: TObject);
        procedure BtnPlay3DClick(Sender: TObject);
        procedure OnUserDirectoryChanged(Sender: TObject);
        procedure OnBookDirectoryChanged(Sender: TObject);
    private
        { Private declarations }
    public
        { Public declarations }
    end;

var
    Form1: TForm1;

implementation

{$R *.DFM}

// ..............................//
// Utility Methods
// ..............................//
procedure Log(Str: String);
begin
    Form1.TxtConsole.Lines.Append(Str);
end;

// ..............................//
// Primary Events
// ..............................//
function GetBookDir(): string;
var
    userName, dropboxDir: string;
begin
    userName := Form1.EdtUserName.Text;
    dropboxDir := Form1.CbxBookDir.Text;
    Result := 'C:\Users\' + userName + '\' + dropboxDir;
end;

function GetFilesDirByType(swfDir: string): String;
var
    filesDir: string;
begin
    filesDir := GetBookDir() + '\' + swfDir;
    Log('MainForm > GetFilesDirByType > dir: ( ' + filesDir + ' )');
    Result := filesDir;
end;

function GetWPOptions(): OWPlayer;
var
    options: OWPlayer;
begin
    // Set-Up options
    options := OWPlayerDefault;
    options.BookDir := GetBookDir();
    options.HiddenPlayer := BoolToInt(Form1.ChkHiddenPlayer.Checked);
    options.HiddenConsole := BoolToInt(Form1.ChkHiddenConsole.Checked);
    options.AutoPlay := BoolToInt(Form1.ChkAutoPlay.Checked);
    options.EscapeEnabled := BoolToInt(Form1.ChkEscapeEnabled.Checked);
    options.Resizable := BoolToInt(Form1.ChkResizable.Checked);
    options.WindowSize := Form1.CbxWindowSize.Text;
    Result := options;
end;

procedure FillListsByType();
var
    dir: string;
begin
    dir := GetBookDir();
    if DirectoryExists(dir) then
    begin
        // Fill Lists by Type
        Log('MainForm > FillListsByType > BookDir: ( ' + dir + ' )');
        FillSWFList(Form1.Cbx3DList, GetFilesDirByType('3d'), 'swf');
        FillSWFList(Form1.CbxAudioList, GetFilesDirByType('audio'), 'mp3');
        FillSWFList(Form1.CbxLessonList, GetFilesDirByType('lessons'), 'swf');
        FillSWFList(Form1.CbxImageList, GetFilesDirByType('photos'), 'jpg');

        // 1) Video Local
        FillSWFList(Form1.CbxVideoList, GetFilesDirByType('video'), 'flv');

        // 2) Video Webstream
        {Dejepis 7 str.55}
        Form1.CbxVideoList.Items.Add('https://www.ceskatelevize.cz/porady/10169631969-stity-kralovstvi-ceskeho/207562235200001-jak-rostly-hrady/');
        {Dejepis 7 str.59}
        Form1.CbxVideoList.Items.Add('https://v11-a.sdn.cz/v_11/vd_10004867_1485859405/h264_aac_720p_mp4/eff19af5.mp4');
        {Dejepis 7 str.65}
        Form1.CbxVideoList.Items.Add('https://v11-a.sdn.cz/v_11/vd_627474_1485976697/h264_aac_720p_mp4/c5ef1af2.mp4');
        {Dejepis 7 str.25} // not used from stream (was downloaded)
        Form1.CbxVideoList.Items.Add('https://www.youtube.com/watch?v=6ldHiLvbVe0');

        // 3) Video Weblink
        {Dejepis 7 str.125}
        Form1.CbxVideoList.Items.Add('https://www.ceskatelevize.cz/ivysilani/10361869257-narodni-klenoty/211563235200002-telc-jezerni-ruze');
        {Dejepis 7 str.106}
        Form1.CbxVideoList.Items.Add('https://www.stream.cz/vylety-do-minulosti/kralovnin-korzar-francis-drake-obeplul-svet-26-9-1580-317312');

        Log(#9 + '3DList:> ( ' + Form1.Cbx3DList.Items.Count.ToString() + ' )');
        Log(#9 + 'AudioList:> ( ' + Form1.CbxAudioList.Items.Count.ToString
          () + ' )');
        Log(#9 + 'LessonList:> ( ' + Form1.CbxLessonList.Items.Count.ToString
          () + ' )');
        Log(#9 + 'PhotoList:> ( ' + Form1.CbxImageList.Items.Count.ToString
          () + ' )');
        Log(#9 + 'VideoList:> ( ' + Form1.CbxVideoList.Items.Count.ToString
          () + ' )');
    end
    else
    begin
        // Clear All Lists
        Form1.Cbx3DList.Clear();
        Form1.CbxAudioList.Clear();
        Form1.CbxLessonList.Clear();
        Form1.CbxImageList.Clear();
        Form1.CbxVideoList.Clear();
    end;
end;

procedure TForm1.OnUserDirectoryChanged(Sender: TObject);
begin
    FillListsByType();
end;

procedure TForm1.OnBookDirectoryChanged(Sender: TObject);
begin
    FillListsByType();
end;

procedure TForm1.BtnPlayAudioClick(Sender: TObject);
begin
    PlayAudio(GetWPOptions(), CbxAudioList.Text);
end;

procedure TForm1.BtnPlayImagesClick(Sender: TObject);
begin
    PlayImages(GetWPOptions(), CbxImageList.Text);
end;

procedure TForm1.BtnPlayLessonClick(Sender: TObject);
var
    options: OWPlayer;
begin
    options := GetWPOptions();
    options.Name := 'Lesson Player:';
    options.MediaType := 'LESSONS';
    options.FileName := CbxLessonList.Text; // 004.swf
    // Button ID ( 04 ) < 04.swf
    options.ButtonID := ExtractFNameWithoutExt(options.FileName);
    WPlayer.Log('Delphi ( MainForm )', WPlayer.OptionsToString(options));
    WPlayer.LoadFile(options);
end;

procedure TForm1.BtnPlayVideoClick(Sender: TObject);
var
    options: OWPlayer;
begin
    options := GetWPOptions();
    options.Name := 'Video Player:';
    options.MediaType := 'VIDEO';
    options.FileName := CbxVideoList.Text; // 158.swf or https://www...
    // Button ID ( 158 or WEBLINK or 'WEBSTREAM' ) < 158.swf or https://www...
    options.ButtonID := GetVideoID(options.FileName);
    WPlayer.Log('Delphi ( MainForm )', WPlayer.OptionsToString(options));
    WPlayer.LoadFile(options);
end;
procedure TForm1.BtnPlay3DClick(Sender: TObject);
// var options: OWPlayer;
begin
    // options := GetWPOptions();
    // options.MediaType := 'STAGE3D';
    // options.ButtonID := GetFilesDirByType('3d') + '\' + Cbx3DList.Text;
    // TODO insert newlines and tabs for output
    // WPlayer.Log('Delphi ( MainForm )', options.ToString());
    // ShowMessage('Delphi ( MainForm )' + options.ToString());
    // ShowMessage('Delphi ( MainForm )' + WPlayer.OptionsToString(options));
    // WPlayer.Log('Delphi ( MainForm )', WPlayer.OptionsToString(options));
    // WPlayer.LoadFile(options);
end;

// ..............................//
// Initialize Form and Variables
// ..............................//
procedure TForm1.OnFormShown(Sender: TObject);
begin
    // ShowMessage('From was shown.');
    WalkerPlayer.CreateWPlayerInstance();
    EdtUserName.Text := GetUserName();
    FillListsByType();
end;

// ..............................//
// Test Events
// ..............................//
procedure TForm1.BtnSayHelloClick(Sender: TObject);
var
    msg, dir: string;
begin
    dir := GetBookDir();
    msg := '>' + #13#10 + '[ Mr.' + EdtUserName.Text + ' ]' + #13#10 +
      'Book path was se to >' + #13#10 + '[ ' + dir + ' ]';
    WPlayer.SayHello(msg);
end;
{
Embed link: <iframe width="1280" height="720" src="https://www.youtube.com/embed/6ldHiLvbVe0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
}
end.



